#!/usr/bin/env node

const download = require('download-git-repo');
const program = require('commander');
const path = require('path');
const ora = require('ora');
const home = require('user-home');
const scaffolder = require('../src/scaffolder');

program
  .usage('<template-name> [project-name]')
  .option('-c, --clone', 'use git clone')
  .option('--offline', 'use cached template');

program.on('--help', function () {
  console.log('  Examples:')
});

program.parse(process.argv);

if (program.args.length < 1) {
  return program.help();
}

var template = 'strudeljs/template-' + program.args[0];
var name = program.args[1];
var tmp = path.join(home, '.strudel-templates', template.replace(/\//g, '-'));
var to = path.resolve(name || '.')

if (template) {
  downloadAndScaffold(template);
}

function downloadAndScaffold(template) {
  var spinner = ora('downloading template');
  spinner.start();
  download(template, tmp, {clone: false}, function (err) {
    console.log(err ? "Error" : "Success");
    scaffolder(name, tmp, to, function (err) {
      console.log('Generated!')
    })
    spinner.stop();
  });
}
